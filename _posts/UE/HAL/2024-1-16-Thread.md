---
layout: post
title: "Thread"
date: 2024-1-16 09:00:00 +0800 
categories: UE
tag: HAL
---
* content
{:toc #markdown-toc}

ä¸€äº›å…³äºUEçš„Threadçš„çŸ¥è¯†

<!-- more -->

> å‚è€ƒï¼š[Multi-Threading: How to Create Threads in UE4](https://michaeljcole.github.io/wiki.unrealengine.com/Multi-Threading:_How_to_Create_Threads_in_UE4)

## What Not to Doä¸è¯¥åšä»€ä¹ˆ

- ä¸è¦å°è¯•åœ¨å…¶ä»–çº¿ç¨‹ä¿®æ”¹ã€åˆ›å»ºæˆ–åˆ é™¤ UObjectï¼

æ‚¨å¯ä»¥å‡†å¤‡æ‰€æœ‰æ•°æ®/æ‰§è¡Œæ‰€æœ‰è®¡ç®—ï¼Œä½†åªæœ‰æ¸¸æˆçº¿ç¨‹åº”è¯¥å®é™…ç”Ÿæˆ/ä¿®æ”¹/åˆ é™¤ UObjects/AActorsã€‚

- Dont try to use TimerManager outside of the game thread ğŸ˜ƒä¸è¦å°è¯•åœ¨æ¸¸æˆçº¿ç¨‹ä¹‹å¤–ä½¿ç”¨ TimerManager ğŸ˜ƒ
- Don't try to draw debug lines/points etc, as it will likely crash, ie DrawDebugLine(etc...)ä¸è¦å°è¯•ç»˜åˆ¶è°ƒè¯•çº¿/ç‚¹ç­‰ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå´©æºƒï¼Œå³ DrawDebugLine(etc...)

Notice (since 4.11):æ³¨æ„ï¼ˆè‡ª4.11èµ·ï¼‰ï¼š

If you want to use the timer, remove, and modify variables use it:å¦‚æœæ‚¨æƒ³ä½¿ç”¨è®¡æ—¶å™¨ã€åˆ é™¤å’Œä¿®æ”¹å˜é‡ï¼Œè¯·ä½¿ç”¨å®ƒï¼š

\#include "Async.h" ... AsyncTask(ENamedThreads::GameThread, []() { // code to execute on game thread here });#includeâ€œå¼‚æ­¥.hâ€ ... AsyncTask(ENamedThreads::GameThread, []() { // åœ¨æ¸¸æˆçº¿ç¨‹ä¸Šæ‰§è¡Œçš„ä»£ç  });

# å¦ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å¼•ç”¨æ•è·å¤±è´¥

é—®é¢˜æè¿°ï¼šUEä¸­ä½¿ç”¨runnableåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹é‡Œä½¿ç”¨AsyncTask(ENamedThreads::Type::GameThread,\[Location,Rotation,this\](){}å¯ä»¥æ•è·Locationå’ŒRotationä½†æ˜¯å¦‚æœä½¿ç”¨å¼•ç”¨æ•è·åˆ™ä¸è¡Œï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ

```c++
//å½“å‰çº¿ç¨‹ï¼šRunnableçš„çº¿ç¨‹
FVector Location = FVector(lon,lat,alt);
FRotator Rotation = FRotator(pitch,heading,roll);
AsyncTask(ENamedThreads::Type::GameThread,[/*&*/Location,/*&*/Rotation,this]()
{
    UE_LOG(LogTemp,Warning,TEXT("%f"),Location.X);
    if (!OnReceiveSyncTrans.ExecuteIfBound(Location, Rotation))
    {
       UE_LOG(LogTemp,Warning,TEXT("OnReceiveSyncTrans not execute"));
    }
});
```

<font color=yellow>ä½¿ç”¨å¼•ç”¨æ•è·Locationå’ŒRotationå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚å› ä¸ºåœ¨åˆ›å»ºLambdaè¡¨è¾¾å¼æ—¶ï¼ŒLocationå’ŒRotationå¯èƒ½å·²ç»è¶…å‡ºäº†å®ƒä»¬çš„ä½œç”¨åŸŸï¼Œåœ¨Lambdaæ‰§è¡Œæ—¶å¯èƒ½æ‰¾ä¸åˆ°è¿™äº›å˜é‡çš„æœ‰æ•ˆå¼•ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¼•ç”¨æ•è·Locationå’ŒRotationå¯èƒ½ä¼šå¯¼è‡´é—®é¢˜çš„åŸå› ã€‚è€ŒUEä¸­çº¿ç¨‹ä¸çº¿ç¨‹äº’ä¸å¹²æ‰°éƒ½æœ‰ç‹¬ç«‹å­˜å‚¨ç©ºé—´ï¼Œå¼•ç”¨çš„æŒ‡é’ˆæ˜¯æ— æ³•è®¿é—®çš„ï¼Œ</font><font color=red>å¤§æ¦‚ï¼Œå› ä¸ºè¿™ä¸ªthisæŒ‡é’ˆå¯ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªç†è®ºå¾ˆå¯èƒ½ä¸æ­£ç¡®</font>

<font color=yellow>ç¬¬äºŒç§å¯èƒ½æ˜¯è¶…å‡ºä½œç”¨åŸŸåLocationå’ŒRotationçš„ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œå¯¼è‡´æ— æ•ˆï¼Œè€Œthiså…³é”®å­—é»˜è®¤æ˜¯ä»¥å¼•ç”¨çš„æ–¹å¼æ•è·çš„ï¼Œå› æ­¤åœ¨Lambdaä¸­å¯ä»¥è®¿é—®thisæŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡çš„æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°ã€‚</font>**æ‚¬å‚å¼•ç”¨ï¼š**è‹¥ä»¥å¼•ç”¨éšå¼æˆ–æ˜¾å¼æ•è·éå¼•ç”¨å®ä½“ï¼Œè€Œåœ¨è¯¥å®ä½“çš„ç”Ÿå­˜æœŸç»“æŸä¹‹åè°ƒç”¨lambdaå¯¹è±¡çš„å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦ï¼Œåˆ™å‘ç”Ÿæœªå®šä¹‰è¡Œä¸ºã€‚C++ çš„é—­åŒ…å¹¶ä¸å»¶é•¿è¢«æ•è·çš„å¼•ç”¨çš„ç”Ÿå­˜æœŸã€‚è¿™åŒæ ·é€‚ç”¨äºè¢«æ•è·çš„thisæŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡çš„ç”Ÿå­˜æœŸã€‚<font color=yellow>å› æ­¤ï¼Œåœ¨ä½¿ç”¨thisæ•è·çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ç¡®ä¿Lambdaçš„æ‰§è¡Œå‘ç”Ÿåœ¨thisæŒ‡å‘çš„å¯¹è±¡çš„æœ‰æ•ˆç”Ÿå‘½å‘¨æœŸå†…ã€‚</font>





> å¤šçº¿ç¨‹æ•™ç¨‹é“¾æ¥ï¼š[ã€UEÂ·å¼•æ“ç¯‡ã€‘Runnableã€TaskGraphã€AsyncTaskã€Asyncå¤šçº¿ç¨‹å¼€å‘æŒ‡å—](https://blog.csdn.net/j756915370/article/details/122752719)
>
> [ã€ŠExploring in UE4ã€‹å¤šçº¿ç¨‹æœºåˆ¶è¯¦è§£(åŸç†åˆ†æ) ](https://zhuanlan.zhihu.com/p/38881269)
>
> [UE4/UE5çš„TaskGraph](https://cloud.tencent.com/developer/article/1897046)
>
> [bç«™ï¼šã€åˆé›†ã€‘UE4 C++è¿›é˜¶(è¿›è¡Œä¸­)](https://www.bilibili.com/video/BV14p4y1a7nj?p=7)
>
> [2wå­— + 40å¼ å›¾å¸¦ä½ å‚é€å¹¶å‘ç¼–ç¨‹ï¼ ](https://www.cnblogs.com/cxuanBlog/p/13523033.html)

